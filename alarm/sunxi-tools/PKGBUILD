# Maintainer : Jason Plum <jplum@archlinuxarm.org>

# Copyright (C) 2012  Alejandro Mery <amery@geeks.cl>, GPLv2+



pkgname=sunxi-tools
pkgver=20140120
pkgrel=1
pkgdesc="Tools for Allwinner SoC family: fex, fel, pheonix_info"
arch=('arm' 'armv7h')
url="https://github.com/linux-sunxi/sunxi-tools"
license=('GPLv2+')
depends=('libusb')
makedepends=('git' 'pkg-config' 'libusb')
provides=('sunxi-tools')

_gitroot="git://github.com/linux-sunxi/sunxi-tools.git"
_gitname="sunxi-tools"

build() {
  cd $srcdir

 ## Git checkout
  if [ -d $srcdir/${_gitname} ] ; then
    msg "Git checkout:  Updating existing tree"
    cd ${_gitname} && git pull
    msg "Git checkout:  Tree has been updated"
  else
    msg "Git checkout:  Retrieving sources"
    git clone --depth 1 ${_gitroot}  
  fi
  msg "Checkout completed"

  cd ${srcdir}/${_gitname}
  
  make
}

package() { 
  cd $srcdir/${_gitname}

  # install README & LICENSE
  install -Dm 644 README $pkgdir/usr/share/doc/$pkgname/README
  install -Dm 644 COPYING $pkgdir/usr/share/licenses/$pkgname/COPYING

  # create directory structure
  mkdir -p $pkgdir/usr/bin

  # copy binaries
  cp fexc $pkgdir/usr/bin
  cp bootinfo $pkgdir/usr/bin
  cp fel $pkgdir/usr/bin
  cp usb-boot $pkgdir/usr/bin
  cp fel-pio $pkgdir/usr/bin
  cp fel-gpio $pkgdir/usr/bin
  cp fel-sdboot $pkgdir/usr/bin
  cp pio $pkgdir/usr/bin
  cp nand-part $pkgdir/usr/bin
  cp jtag-loop.sunxi $pkgdir/usr/bin
  cp phoenix_info $pkgdir/usr/bin

  # make symlinks for bin2fex/fex2bin
  cd $pkgdir/usr/bin
  ln -s fexc fex2bin
  ln -s fexc bin2fex
}
